<!DOCTYPE html>
<html>
<head>
  <title>Walkie-Talkie Mooka</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    #login { margin: 20px auto; width: 300px; }
    #chat { display: none; margin: 20px auto; width: 300px; }
    button { padding: 10px 20px; margin: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; }
    #hablar { background: #f44336; width: 200px; height: 200px; border-radius: 100px; font-size: 20px; }
    #hablar:active { background: #d32f2f; }
    input { padding: 10px; margin: 5px; width: 200px; }
  </style>
</head>
<body>

<div id="login">
  <h2>Walkie-Talkie Privado</h2>
  <p>Solo para amigos que conocen la clave</p>
  <input type="text" id="usuario" placeholder="Tu nombre" required><br>
  <input type="password" id="clave" placeholder="Clave secreta" required><br>
  <button onclick="verificarClave()">Entrar</button>
</div>

<div id="chat">
  <h2>Hola, <span id="nombre-usuario"></span>!</h2>
  <p>Mantén presionado para hablar:</p>
  <button id="hablar" ontouchstart="iniciarGrabacion()" onmousedown="iniciarGrabacion()" 
          ontouchend="detenerGrabacion()" onmouseup="detenerGrabacion()">HABLAR</button>
  <div id="mensajes"></div>
</div>

<script>
  const CLAVE_SECRETA = "mooka"; // La clave que todos deben saber
  let mediaRecorder;
  let audioChunks = [];

  function verificarClave() {
    const usuario = document.getElementById('usuario').value;
    const clave = document.getElementById('clave').value;
    
    if (clave === CLAVE_SECRETA) {
      document.getElementById('login').style.display = 'none';
      document.getElementById('chat').style.display = 'block';
      document.getElementById('nombre-usuario').textContent = usuario;
      inicializarAudio();
    } else {
      alert("Clave incorrecta. Solo para amigos que conocen 'mooka'");
    }
  }

  async function inicializarAudio() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      
      mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
      };
      
      mediaRecorder.onstop = () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        audioChunks = [];
        reproducirAudio(audioBlob);
      };
    } catch (error) {
      alert("Error al acceder al micrófono: " + error.message);
    }
  }

  function iniciarGrabacion() {
    if (mediaRecorder && mediaRecorder.state !== 'recording') {
      mediaRecorder.start();
      document.getElementById('hablar').textContent = "GRABANDO...";
    }
  }

  function detenerGrabacion() {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
      mediaRecorder.stop();
      document.getElementById('hablar').textContent = "HABLAR";
    }
  }

  function reproducirAudio(audioBlob) {
    const audioURL = URL.createObjectURL(audioBlob);
    const audioElement = new Audio(audioURL);
    audioElement.controls = true;
    
    const mensajesDiv = document.getElementById('mensajes');
    const mensajeDiv = document.createElement('div');
    mensajeDiv.innerHTML = `<p>${document.getElementById('usuario').value}:</p>`;
    mensajeDiv.appendChild(audioElement);
    mensajesDiv.appendChild(mensajeDiv);
    
    audioElement.play();
  }
</script>

</body>
</html>
