<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... (código anterior igual) ... -->
</head>
<body>
    <div class="access-container">
        <h2>Acceso a Transmisión Privada</h2>
        <div class="form-group">
            <input type="password" id="accessKey" placeholder="Ingresa la palabra clave">
        </div>
        <button class="access-btn" id="accessBtn">Ingresar</button>
        <div id="accessError" class="access-error"></div>
    </div>

    <script>
        // ... (configuración de Firebase igual) ...

        // Verificar acceso
        async function checkAccess() {
            const accessKeyInput = document.getElementById('accessKey');
            const accessError = document.getElementById('accessError');
            const enteredKey = accessKeyInput.value.trim();
            
            if (enteredKey === ACCESS_KEY) {
                // Deshabilitar botón para evitar múltiples clics
                document.getElementById('accessBtn').disabled = true;
                accessError.textContent = "Verificando...";
                
                try {
                    // Obtener y registrar IP
                    const userIP = await getUserIP();
                    await registerAccess(userIP);
                    
                    // Redirigir después de completar las operaciones
                    window.location.href = "transmision.html";
                } catch (error) {
                    console.error("Error:", error);
                    accessError.textContent = "Error al verificar acceso. Recarga la página.";
                    document.getElementById('accessBtn').disabled = false;
                }
            } else {
                accessError.textContent = "Palabra clave incorrecta";
            }
        }

        // Event listeners mejorados
        document.getElementById('accessBtn').addEventListener('click', checkAccess);
        document.getElementById('accessKey').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAccess();
        });
    </script>
</body>
</html>
